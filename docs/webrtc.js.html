<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: webrtc.js</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="keyword" content="" />
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    <meta property="og:site_name" content=""/>
    <meta property="og:url" content=""/>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"JsHelpers","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">JsHelpers</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="ActionHelper">
            <span class="title">
                <a href="ActionHelper.html">ActionHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ActionHelper#getInstance"><a href="ActionHelper.html#getInstance">getInstance</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ActionHelper#execute"><a href="ActionHelper.html#execute">execute</a></li>
            
                <li data-name="ActionHelper#redirect"><a href="ActionHelper.html#redirect">redirect</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="AnalyticsHelper">
            <span class="title">
                <a href="AnalyticsHelper.html">AnalyticsHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="AnalyticsHelper#getInstance"><a href="AnalyticsHelper.html#getInstance">getInstance</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="AutocompletionHelper">
            <span class="title">
                <a href="AutocompletionHelper.html">AutocompletionHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="AutocompletionHelper#addResult"><a href="AutocompletionHelper.html#addResult">addResult</a></li>
            
                <li data-name="AutocompletionHelper#changeResult"><a href="AutocompletionHelper.html#changeResult">changeResult</a></li>
            
                <li data-name="AutocompletionHelper#init"><a href="AutocompletionHelper.html#init">init</a></li>
            
                <li data-name="AutocompletionHelper#typingTimeout"><a href="AutocompletionHelper.html#typingTimeout">typingTimeout</a></li>
            
                <li data-name="AutocompletionHelper#updateResultContainer"><a href="AutocompletionHelper.html#updateResultContainer">updateResultContainer</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="AutocompletionHelper#event:hideResultContainer"><a href="AutocompletionHelper.html#event:hideResultContainer">hideResultContainer</a></li>
            
                <li data-name="AutocompletionHelper#event:removeSelected"><a href="AutocompletionHelper.html#event:removeSelected">removeSelected</a></li>
            
                <li data-name="AutocompletionHelper#event:selectResult"><a href="AutocompletionHelper.html#event:selectResult">selectResult</a></li>
            
                <li data-name="AutocompletionHelper#event:showResultContainer"><a href="AutocompletionHelper.html#event:showResultContainer">showResultContainer</a></li>
            
                <li data-name="AutocompletionHelper#event:typing"><a href="AutocompletionHelper.html#event:typing">typing</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="JsHelper">
            <span class="title">
                <a href="JsHelper.html">JsHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="JsHelper#addGlobalFunction"><a href="JsHelper.html#addGlobalFunction">addGlobalFunction</a></li>
            
                <li data-name="JsHelper#cloneArray"><a href="JsHelper.html#cloneArray">cloneArray</a></li>
            
                <li data-name="JsHelper#cloneObject"><a href="JsHelper.html#cloneObject">cloneObject</a></li>
            
                <li data-name="JsHelper#extendSingleton"><a href="JsHelper.html#extendSingleton">extendSingleton</a></li>
            
                <li data-name="JsHelper#getSingleton"><a href="JsHelper.html#getSingleton">getSingleton</a></li>
            
                <li data-name="JsHelper#idDefined"><a href="JsHelper.html#idDefined">idDefined</a></li>
            
                <li data-name="JsHelper#ifNull"><a href="JsHelper.html#ifNull">ifNull</a></li>
            
                <li data-name="JsHelper#init"><a href="JsHelper.html#init">init</a></li>
            
                <li data-name="JsHelper#loadCss"><a href="JsHelper.html#loadCss">loadCss</a></li>
            
                <li data-name="JsHelper#ucfirst"><a href="JsHelper.html#ucfirst">ucfirst</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="PaginationHelper">
            <span class="title">
                <a href="PaginationHelper.html">PaginationHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="PaginationHelper#checkNavigation"><a href="PaginationHelper.html#checkNavigation">checkNavigation</a></li>
            
                <li data-name="PaginationHelper#checkRange"><a href="PaginationHelper.html#checkRange">checkRange</a></li>
            
                <li data-name="PaginationHelper#init"><a href="PaginationHelper.html#init">init</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="PaginationHelper#event:updateCurrentpage"><a href="PaginationHelper.html#event:updateCurrentpage">updateCurrentpage</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="PopupHelper">
            <span class="title">
                <a href="PopupHelper.html">PopupHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="PopupHelper#getInstance"><a href="PopupHelper.html#getInstance">getInstance</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="WebsocketHelper">
            <span class="title">
                <a href="WebsocketHelper.html">WebsocketHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="WebsocketHelper#getInstance"><a href="WebsocketHelper.html#getInstance">getInstance</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="WebsocketHelper#addEvent"><a href="WebsocketHelper.html#addEvent">addEvent</a></li>
            
                <li data-name="WebsocketHelper#addEvent"><a href="WebsocketHelper.html#addEvent">addEvent</a></li>
            
                <li data-name="WebsocketHelper#addEvents"><a href="WebsocketHelper.html#addEvents">addEvents</a></li>
            
                <li data-name="WebsocketHelper#init"><a href="WebsocketHelper.html#init">init</a></li>
            
                <li data-name="WebsocketHelper#send"><a href="WebsocketHelper.html#send">send</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="WebsocketHelper#event:connected"><a href="WebsocketHelper.html#event:connected">connected</a></li>
            
                <li data-name="WebsocketHelper#event:disconnect"><a href="WebsocketHelper.html#event:disconnect">disconnect</a></li>
            
                <li data-name="WebsocketHelper#event:disconnected"><a href="WebsocketHelper.html#event:disconnected">disconnected</a></li>
            
                <li data-name="WebsocketHelper#event:error"><a href="WebsocketHelper.html#event:error">error</a></li>
            
                <li data-name="WebsocketHelper#event:recv"><a href="WebsocketHelper.html#event:recv">recv</a></li>
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="webrtc.js.html">Source: webrtc.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*global B, extendSingleton, getSingleton, UserHelper, isDefined, VoiceHelper */
var WebrtcHelper;
window.RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
(function(){
    "use strict";


    WebrtcHelper = function(){   
        this.connectButton = null;
        this.disconnectButton = null;
        this.sendButton = null;
        this.messageInputBox = null;
        this.receiveBox = null;

        this.localConnection = null;   // RTCPeerConnection for our "local" connection
        this.remoteConnection = null;  // RTCPeerConnection for the "remote"

        this.sendChannel = null;       // RTCDataChannel for the local (sender)
        this.receiveChannel = null;    // RTCDataChannel for the remote (receiver)

        this.events = {};
        extendSingleton(WebrtcHelper);                
    };

    /**
     * @member WebrtcHelper#getInstance
     * @description get the single class instance
     * @return {WebrtcHelper} the single class instance
     */
    WebrtcHelper.getInstance = function(cb){
        if(isDefined(cb)){
            getSingleton(WebrtcHelper, cb);
        } else {
            return getSingleton(WebrtcHelper);
        }
    };


    WebrtcHelper.prototype.init = function(events){
        if(events){
            this.events = events;
        }
        this.connectPeers();
    };

    WebrtcHelper.prototype.connectPeers = function() {
        var that = this;

        this.localConnection = new RTCPeerConnection();

        this.sendChannel = this.localConnection.createDataChannel("sendChannel");
        this.sendChannel.onopen = this.handleSendChannelStatusChange.bind(this);
        this.sendChannel.onclose = this.handleSendChannelStatusChange.bind(this);

        this.remoteConnection = new RTCPeerConnection();
        this.remoteConnection.ondatachannel = this.receiveChannelCallback.bind(this);

        this.localConnection.onicecandidate = e => !e.candidate
        || this.remoteConnection.addIceCandidate(e.candidate)
        .catch(this.handleAddCandidateError.bind(this));

        this.remoteConnection.onicecandidate = e => !e.candidate
        || this.localConnection.addIceCandidate(e.candidate)
        .catch(this.handleAddCandidateError.bind(this));



        this.localConnection.createOffer()
        .then(offer => that.localConnection.setLocalDescription(offer))
        .then(() => that.remoteConnection.setRemoteDescription(that.localConnection.localDescription))
        .then(() => that.remoteConnection.createAnswer())
        .then(answer => that.remoteConnection.setLocalDescription(answer))
        .then(() => that.localConnection.setRemoteDescription(that.remoteConnection.localDescription))
        .catch(this.handleCreateDescriptionError.bind(this));
    }


    WebrtcHelper.prototype.handleCreateDescriptionError = function(error) {
        console.error("Unable to create an offer: " + error.toString());
    }


    WebrtcHelper.prototype.handleLocalAddCandidateSuccess = function() {
        if(this.events.onConnect){
            this.events.onConnect();
        }
    }


    WebrtcHelper.prototype.handleRemoteAddCandidateSuccess = function() {
        if(this.events.onConnect){
            this.events.onConnect();
        }
    }

    WebrtcHelper.prototype.handleAddCandidateError = function() {
        console.error("Oh noes! addICECandidate failed!");
    }

    WebrtcHelper.prototype.sendMessage = function(data) {
        this.sendChannel.send(data);
        console.log("data send", data);
    }

    WebrtcHelper.prototype.handleSendChannelStatusChange = function(event) {
        if (this.sendChannel) {
            var state = this.sendChannel.readyState;

            if (state === "open") {
                console.log("state open");
                if(this.events.onOpen){
                    this.events.onOpen();
                }
            } else {
                console.warn("state close");
                if(this.events.onClose){
                    this.events.onClose();
                }
            }
        }
    }

    WebrtcHelper.prototype.receiveChannelCallback = function(event) {
        this.receiveChannel = event.channel;
        this.receiveChannel.onmessage = this.handleReceiveMessage.bind(this);
        this.receiveChannel.onopen = this.handleReceiveChannelStatusChange.bind(this);
        this.receiveChannel.onclose = this.handleReceiveChannelStatusChange.bind(this);
    }

    WebrtcHelper.prototype.handleReceiveMessage = function(event) {
        console.log("data received", event.data);
    }

    WebrtcHelper.prototype.handleReceiveChannelStatusChange = function(event) {
        if (this.receiveChannel) {
            console.log("Receive channel's status has changed to " +
                this.receiveChannel.readyState);
        }

    }

    WebrtcHelper.prototype.disconnectPeers = function() {

        this.sendChannel.close();
        this.receiveChannel.close();

        this.localConnection.close();
        this.remoteConnection.close();

        this.sendChannel = null;
        this.receiveChannel = null;
        this.localConnection = null;
        this.remoteConnection = null;
    }

})();</code></pre>
        </article>
    </section>





        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 16 2018 15:21:10 GMT+0100 (CET)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>